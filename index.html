<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="icono.png" sizes="192x192">

    <title>Reporte de voz GT</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/stylish-portfolio.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet"
        type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- About -->
    <section id="about" class="about">
        <div class="container">
            <div class="foto">
                <img src="img/compo.jpg" alt="">
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h3 style="color: #337ab7;">1. Toca el botón para hablar, dí qué quieres reportar y tócalo de nuevo para terminar.</h3>
                    <h3 style="color: #337ab7;">2. Si el texto que aparece está bien, toca el botón de Aceptar.</h3>
                    <h3 style="color: #337ab7;">3. Finalmente, toca el botón de Enviar.</h3>
                    <a href="#tipodereporte" class="btn btn-success btn-lg" id="botonseguir">Hacer un reporte!</a><br>

                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container -->
    </section>

    <!-- Services -->
    <!-- The circle icons use Font Awesome's stacked icon classes. For more information, visit http://fontawesome.io/examples/ -->
    <section id="services" class="services bg-primary">
        <div class="container">
            <div class="row text-center">
                <div class="col-lg-10 col-lg-offset-1">
                    <hr class="small">

                    <form method="POST" action="resultados.php" id="forma">

                        <div class="service-item" id="tipodereporte">
                            <div id="nombre" style="background-color: rgb(83,156,218); border-radius:1em; padding:10px; ">
                                <h3>¿Qué quieres reportar?</h3>

                                <label class="radio-inline">
                                <input id="condicion" type="radio" name="nameradio" value="Condición">Condición
                                </label>
                                <label class="radio-inline">
                                <input id="acto" type="radio" name="nameradio" value="Acto" >Acto
                                </label>
                                <label class="radio-inline">
                                <input id="observación" type="radio" name="nameradio" value="Observación" >Observación
                                </label>
                            </div>
                        </div>


                        <div class="service-item">
                            <div id="nombre" style="background-color: rgb(83,156,218); border-radius:1em; padding:10px; ">
                                <span class="fa-stack fa-2x">
                                    <i class="fa fa-circle fa-stack-2x" id="bolitaindicadoraNombre" ></i>
                                    <i class="fa fa-microphone fa-stack-1x text-primary"></i>
                                </span>
                                <h4 id="instruccionesNombre">
                                    <strong>Toca una vez el botón para grabar. Al oir el tono, di claramente tu nombre.</strong>
                                    <h4 id="instrucciones"><strong></strong></h4>
                                </h4>

                                <!--botón reconocer nombre --><a onclick="reconocenombre(event);" class="btn btn-danger btn-lg" id="botonhablarNombre">Graba tu nombre</a><br><br>

                                <div class="campodereconocimiento">
                                    <p id="textoresultadonombre">Acá aparecerá tu nombre:</p>
                                </div><br>

                                <a onclick="aceptarNombre();" class="btn btn-warning btn-lg">Aceptar</a><br><br>
                                <label for="#nombre">Nombre: </label>
                                <input type="text" class="form-control" placeholder="Nombre" id="entradanombre" name="namenombre"><br>

                                <a href="#sliders" onclick="consolidar();" class="btn btn-default">Siquiente</a>

                            </div>
                        </div>


                        <br>
                        <hr><br>


                        <div id="sliders" class="service-item" id="reporte">
                            <div>
                                <!--PROBABILIDAD-->
                                <div style="background-color: rgb(83,156,218); border-radius:1em; padding:10px; ">
                                    <h4>Probabilidad:
                                        <h4>


                                </div><br>
                                <!--SEVERIDAD-->
                                <div style="background-color: rgb(83,156,218); border-radius:1em; padding:10px; ">
                                    <h4>Severidad:
                                        <h4>

                                </div><br>
                            </div>


                            <br><br>
                            <hr><br><br>

                            <!--REPORTE-->
                            <div id="reporte" style="background-color: rgb(83,156,218); border-radius:1em; padding:10px;">
                                <h2>Reporte</h2>
                                <span class="fa-stack fa-2x">
                                        <i class="fa fa-circle fa-stack-2x" id="bolitaindicadoraReporte" ></i>
                                        <i class="fa fa-microphone fa-stack-1x text-primary"></i>
                                     </span>
                                <h4 id="instruccionesReporte">
                                    <strong>Toca una vez el botón para grabar. Al oir el tono, di claramente tu reporte.</strong>
                                    <h4 id="instrucciones"><strong></strong></h4>
                                </h4>

                                <!--botón reconocer reporte --><a onclick="reconocereporte(event);" class="btn btn-danger btn-lg" id="botonhablarReporte">Graba tu reporte</a><br><br>

                                <div class="campodereconocimientoReporte">
                                    <p id="textoresultadoReporte">Acá aparecerá tu reporte:</p>
                                </div><br>

                                <a onclick="aceptarReporte();" class="btn btn-warning btn-lg">Aceptar</a><br><br>

                                <label for="#entradareporte">Reporte: </label>
                                <input type="textarea" class="form-control" placeholder="Reporte" id="entradaReporte" name="namereporte"><br>

                                <a href="#plandeaccion" onclick="consolidar();" class="btn btn-default">Siquiente</a>

                            </div><br>

                            <br><br>
                            <hr><br><br>

                            <!--PLAN DE ACCION-->
                            <div id="plandeaccion" style="background-color: rgb(83,156,218); border-radius:1em; padding:10px;">
                                <h2>Plan de acción</h2>
                                <span class="fa-stack fa-2x">
                                        <i class="fa fa-circle fa-stack-2x" id="bolitaindicadoraPlan" ></i>
                                        <i class="fa fa-microphone fa-stack-1x text-primary"></i>
                                     </span>
                                <h4 id="instruccionesPlan">
                                    <strong>Toca una vez el botón para grabar. Al oir el tono, di claramente tu plan de acción.</strong>
                                    <h4 id="instrucciones"><strong></strong></h4>
                                </h4>

                                <!--botón reconocer plan  --><a onclick="reconoceplan(event);" class="btn btn-danger btn-lg" id="botonhablarPlan">Graba tu plan</a><br><br>

                                <div class="campodereconocimientoPlanDeAccion">
                                    <p id="resultadoPlanDeaccion">Acá aparecerá tu plan de acción:</p>
                                </div><br>
                                <a onclick="aceptarPlanDeAccion();" class="btn btn-warning btn-lg">Aceptar</a><br><br>
                                <label for="#InputPlanDeAccion">Plan de Acción: </label>
                                <input type="textarea" class="form-control" placeholder="Plan de Acción" id="entradaPlan" name="nameplan"><br>

                                <a href="#resumen" onclick="consolidar();" class="btn btn-default">Siquiente</a>

                            </div><br>


                        </div>

                        <br><br>
                        <hr><br><br>

                        <div id="resumen" style="background-color: rgb(83,156,218); border-radius:1em; padding:10px;">

                            <!--<h2>Resumen</h2>
                                    <p>Revisa que tu reporte está bien y toca "Enviar", de lo contrario, toca "Corregir" para repetir</p>
                                    <a onclick="consolidar()" class="btn btn-success">Revisa tu reporte</a>
                                
                                    <h3>Tipo de reporte:</h3>
                                    <p id="finalresultadotipo">Tipo</p>

                                    <h3>Nombre:</h3>
                                    <p id="finalresultadonombre">nombre</p>
                                    <input type="text" class="form-control" id="inputfinalnombre" name="nombre">

                                    <h3>Probabilidad:</h3>
                                    <p id="finalresultadoprobabilidad">Probabilidad</p>
                                    <input type="text" class="form-control" id="inputfinalprobabilidad" name="probabilidad">

                                    <h3>Severidad:</h3>
                                    <p id="finalresultadoseveridad">Severidad</p>
                                    <input type="text" class="form-control" id="inputfinalseveridad" name="severidad">

                                    <h3>Reporte:</h3>
                                    <p id="finalresultadoreporte">Reporte</p>
                                    <input type="text" class="form-control" id="inputfinalreporte" name="reporte">

                                    <h3>Plan de acción:</h3>
                                    <p id="finalresultadoplan">Plan</p>
                                    <input type="text" class="form-control" id="inputfinalplan" name="plan">-->



                            <h2>Revisión Final</h2>
                            <!--<a onclick="consolidar()" href="resultados.html" class="btn btn-success" >Revisar...</a>-->
                            <input type="submit" value="enviar" class="btn btn-success btn-lg">
                        </div>

                    </form>

                    <!-- /.row (nested) -->
                </div>
                <!-- /.col-lg-10 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container -->
    </section>


    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!--Recorder JavaScript -->
    <script src="js/recorder.js"></script>

    <!--Site functions JavaScript -->
    <script src="js/main.js"></script>

    <script>
        //revisa si online
        if (navigator.onLine == false) {
            alert("La aplicación no funcionará sin conexión a Inernet. Por favor revisa tu conexión e intenta de nuevo");
        }



        //definimos variables
        var tipodereporte = '';
        var valordeprobabilidad = 0;
        var valordeseveridad = 0;
        var loQueEstoyReconociendo = "nombre";
        var textolresultadonombre = document.getElementById("textoresultadonombre");
        var textoresultadoReporte = document.getElementById("textoresultadoReporte");
        var textoresultadoPlanDeaccion = document.getElementById("resultadoPlanDeaccion");

        var gransalidatipo = '';
        var gransalidanombre = '';
        var gransalidaprobabilidad = '';
        var gransalidaseveridad = '';
        var gransalidareporte = '';
        var gransalidaplan = '';



        function asignatipodereporte(x) {
            tipodereporte = x;
            console.log(tipodereporte);


            // para poner los colorcitos de los botones seleccionados
            switch (tipodereporte) {
                case 'Acto':
                    $('#botacto').removeClass('btn-basic').addClass('btn-warning');
                    $('#botcondicion').removeClass('btn-basic').addClass('btn-basic');
                    $('#botobservacion').removeClass('btn-basic').addClass('btn-basic');
                    $('#botcondicion').removeClass('btn-warning').addClass('btn-basic');
                    $('#botobservacion').removeClass('btn-warning').addClass('btn-basic');
                    break;
                case 'Condición':
                    $('#botcondicion').removeClass('btn-basic').addClass('btn-warning');
                    $('#botobservacion').removeClass('btn-basic').addClass('btn-basic');
                    $('#botacto').removeClass('btn-basic').addClass('btn-basic');
                    $('#botobservacion').removeClass('btn-warning').addClass('btn-basic');
                    $('#botacto').removeClass('btn-warning').addClass('btn-basic');
                    break;
                case 'Observación':
                    $('#botobservacion').removeClass('btn-basic').addClass('btn-warning');
                    $('#botacto').removeClass('btn-basic').addClass('btn-basic');
                    $('#botcondicion').removeClass('btn-basic').addClass('btn-basic');
                    $('#botacto').removeClass('btn-warning').addClass('btn-basic');
                    $('#botcondicion').removeClass('btn-warning').addClass('btn-basic');
                    break;
            }

            gransalidatipo = tipodereporte;
            consolidar();

        }





        // reconocedor de voz:    

        if (!('webkitSpeechRecognition' in window)) {
            //Speech API not supported here…
            alert("Navegador no soportado. Intenta con Chrome");
        } else { //Let’s do some cool stuff :)
            var recognition = new webkitSpeechRecognition(); //That is the object that will manage our whole recognition process. 
            recognition.continuous = true;   //Suitable for dictation. 
            recognition.interimResults = true;  //If we want to start receiving results even if they are not final.
            //Define some more additional parameters for the recognition:
            recognition.lang = "es-CO";
            recognition.maxAlternatives = 4; //Since from our experience, the highest result is really the best...
            var reconociendo = false;
            console.log('reconociendo: ' + reconociendo);  //para saber en consola si está reconociendo nada mas
        }

        recognition.onstart = function () {
            //Listening (capturing voice from audio input) started.
            //This is a good place to give the user visual feedback about that (i.e. flash a red light, etc.)

            if (loQueEstoyReconociendo == "nombre") {
                bolitaindicadoraNombre.style.color = "red";
                document.getElementById("botonhablarNombre").innerHTML = "Detener la grabación";
                document.getElementById("instruccionesNombre").innerHTML = "Toca el botón rojo para detener la grabación";
                document.getElementById("entradanombre").value = "";
            }
            if (loQueEstoyReconociendo == "reporte") {
                bolitaindicadoraReporte.style.color = "red";
                document.getElementById("botonhablarReporte").innerHTML = "Detener la grabación";
                document.getElementById("instruccionesReporte").innerHTML = "Toca el botón rojo para detener la grabación";
                document.getElementById("entradaReporte").value = "";
            }
            if (loQueEstoyReconociendo == "plan") {
                bolitaindicadoraPlan.style.color = "red";
                document.getElementById("botonhablarPlan").innerHTML = "Detener la grabación";
                document.getElementById("instruccionesPlan").innerHTML = "Toca el botón rojo para detener la grabación";
                document.getElementById("entradaPlan").value = "";
            }

            reconociendo = true;
            console.log('reconociendo: ' + reconociendo);  //para saber en consola si está reconociendo nada mas


        };

        recognition.onend = function () {
            //Again – give the user feedback that you are not listening anymore. If you wish to achieve continuous recognition – you can write a script to start the recognizer again here.


            if (loQueEstoyReconociendo == "nombre") {
                bolitaindicadoraNombre.style.color = "white";
                document.getElementById("botonhablarNombre").innerHTML = "Toca aquí para grabar";
                document.getElementById("instruccionesNombre").innerHTML = "Toca Aceptar para confirmar o Grabar para repetir";
            }
            if (loQueEstoyReconociendo == "reporte") {
                bolitaindicadoraReporte.style.color = "white";
                document.getElementById("botonhablarReporte").innerHTML = "Toca aquí para grabar";
                document.getElementById("instruccionesReporte").innerHTML = "Toca Aceptar para confirmar o Grabar para repetir";
            }
            if (loQueEstoyReconociendo == "plan") {
                bolitaindicadoraPlan.style.color = "white";
                document.getElementById("botonhablarPlan").innerHTML = "Toca aquí para grabar";
                document.getElementById("instruccionesPlan").innerHTML = "Toca Aceptar para confirmar o Grabar para repetir";
            }

            console.log('reconociendo: ' + reconociendo);  //para saber en consola si está reconociendo nada mas
        };

        recognition.onresult = function (event) { //the event holds the results
            //Yay – we have results! Let’s check if they are defined and if final or not:
            if (typeof (event.results) === 'undefined') { //Something is wrong…
                recognition.stop();
                alert("Error. Revisa tu conexión");
                return;

            }

            for (var i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) { //Final results
                    console.log("final results: " + event.results[i][0].transcript);
                    //Of course – here is the place to do useful things with the results.

                    // RESULTADOS

                    granResultadovariable = event.results[i][0].transcript;

                    if (loQueEstoyReconociendo == "nombre") {
                        granResultadoNombre = granResultadovariable;
                        textolresultadonombre.innerHTML = granResultadoNombre;
                    }
                    if (loQueEstoyReconociendo == "reporte") {
                        granResultadoReporte = granResultadovariable;
                        textoresultadoReporte.innerHTML = granResultadoReporte;
                    }
                    if (loQueEstoyReconociendo == "plan") {
                        granResultadoPlan = granResultadovariable;
                        textoresultadoPlanDeaccion.innerHTML = granResultadoPlan;
                    }
                    reconociendo = false;
                    console.log('reconociendo: ' + reconociendo);  //para saber en consola si está reconociendo nada mas

                } else {   //i.e. interim...
                    console.log("interim results: " + event.results[i][0].transcript);  //You can use these results to give the user near real time experience.
                }
            } //end for loop
        };

        //gatillo de reconocimiento para nombre. Si no hay internet no deja hacer nada
        function reconocenombre(event) {
            if (navigator.onLine == false) {
                alert("La aplicación no funcionará sin conexión a Inernet. Por favor revisa tu conexión e intenta de nuevo");
            }
            if (navigator.onLine == true) {
                loQueEstoyReconociendo = "nombre";
/*
                if (reconociendo == true) {
                    recognition.stop();
                }
                if (reconociendo == false) {
                    recognition.stop();
                    recognition.start();
                }
*/
                if (reconociendo === true) {
                    reconociendo = false;
                    stopRecording(event.currentTarget);
                } else {
                    reconociendo = true;
                    startRecording(event.currentTarget);
                }
            }
        }


        //gatillo de reconocimiento para reporte. Si no hay internet no deja hacer nada
        function reconocereporte(event) {
            if (navigator.onLine == false) {
                alert("La aplicación no funcionará sin conexión a Inernet. Por favor revisa tu conexión e intenta de nuevo");
            }
            if (navigator.onLine == true) {
                loQueEstoyReconociendo = "reporte";
                if (reconociendo == true) {
                    recognition.stop();
                }
                if (reconociendo == false) {
                    recognition.stop();
                    recognition.start();
                }
            }

        }

        //gatillo de reconocimiento para plan. Si no hay internet no deja hacer nada
        function reconoceplan(event) {
            if (navigator.onLine == false) {
                alert("La aplicación no funcionará sin conexión a Inernet. Por favor revisa tu conexión e intenta de nuevo");
            }
            if (navigator.onLine == true) {
                loQueEstoyReconociendo = "plan";
                if (reconociendo == true) {
                    recognition.stop();
                }
                if (reconociendo == false) {
                    recognition.stop();
                    recognition.start();
                }
            }
        }


        //-----------------------------------   

        function aceptarNombre() {
            document.getElementById("entradanombre").value = granResultadoNombre;
            gransalidanombre = granResultadoNombre;
            consolidar();
        }

        function aceptarReporte() {
            document.getElementById("entradaReporte").value = granResultadoReporte;
            gransalidareporte = granResultadoReporte;
            consolidar();
        }

        function aceptarPlanDeAccion() {
            document.getElementById("entradaPlan").value = granResultadoPlan;
            gransalidaplan = granResultadoPlan
            consolidar();
        }


        //Resumen
        function consolidar() {
            console.log(gransalidatipo);
            console.log(gransalidanombre);
            console.log(gransalidaprobabilidad);
            console.log(gransalidaseveridad);
            console.log(gransalidareporte);
            console.log(gransalidaplan);


            document.getElementById("finalresultadotipo").innerHTML = gransalidatipo;
            document.getElementById("finalresultadonombre").innerHTML = gransalidanombre;
            document.getElementById("finalresultadoprobabilidad").innerHTML = gransalidaprobabilidad;
            document.getElementById("finalresultadoseveridad").innerHTML = gransalidaseveridad;
            document.getElementById("finalresultadoreporte").innerHTML = gransalidareporte;
            document.getElementById("finalresultadoplan").innerHTML = gransalidaplan;

            localStorage.setItem("tipo", gransalidatipo);
            localStorage.setItem("nombre", gransalidanombre);
            localStorage.setItem("severidad", gransalidaseveridad);
            localStorage.setItem("probabilidad", gransalidaprobabilidad);
            localStorage.setItem("reporte", gransalidareporte);
            localStorage.setItem("plan", gransalidaplan);


        }







        function enviar() {

        }
    </script>

    <pre id="log"></pre>
    <ul id="recordingslist"></ul>
</body>

</html>